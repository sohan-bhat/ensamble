<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ensemble</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>

  <!-- Header -->
  <header class="site-header">
    <h1 class="logo">Ensemble</h1>
    <p class="tagline">A shared score for the world</p>
  </header>

  <!-- Score metadata -->
  <div class="score-meta">
    <h2 class="piece-title">Global Symphonia No. 1</h2>
    <div class="meta-details">
      <span class="key-sig">D Major</span>
      <span class="meta-dot">&middot;</span>
      <span class="time-sig">4/4</span>
      <span class="meta-dot">&middot;</span>
      <span class="tempo-display">&#9833; = 100</span>
    </div>
    <div class="note-count"><span id="note-count-num">0</span> notes contributed from around the world</div>
  </div>

  <!-- Transport controls -->
  <div class="transport">
    <div class="transport-left">
      <button id="play-btn" class="transport-btn" title="Play / Pause (Space)">
        <svg id="play-icon" width="18" height="18" viewBox="0 0 18 18" fill="currentColor">
          <polygon points="3,1 15,9 3,17"/>
        </svg>
        <svg id="pause-icon" width="18" height="18" viewBox="0 0 18 18" fill="currentColor" style="display:none">
          <rect x="2" y="1" width="5" height="16"/>
          <rect x="11" y="1" width="5" height="16"/>
        </svg>
      </button>
      <button id="stop-btn" class="transport-btn" title="Stop">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor">
          <rect x="3" y="3" width="12" height="12"/>
        </svg>
      </button>
    </div>
    <div class="transport-center">
      <button id="prev-measure" class="transport-btn-sm" title="Previous measure (&larr;)">&larr;</button>
      <span id="measure-indicator">Measure 1</span>
      <button id="next-measure" class="transport-btn-sm" title="Next measure (&rarr;)">&rarr;</button>
    </div>
    <div class="transport-right">
      <span class="tempo-label">&#9833; = <span id="tempo-value">100</span></span>
    </div>
  </div>

  <!-- Keyboard shortcut hint -->
  <div class="shortcut-hint">
    <span>Space</span> Play &nbsp;
    <span>E</span> Edit &nbsp;
    <span>Esc</span> Close &nbsp;
    <span>1-5</span> Duration &nbsp;
    <span>R</span> Rest &nbsp;
    <span>V</span> Vibrato
  </div>

  <!-- Score container -->
  <div id="score-wrapper">
    <div id="instrument-labels"></div>
    <div id="score"></div>
  </div>

  <!-- Add instrument button -->
  <div class="add-instrument-area">
    <button class="add-instrument-btn" disabled title="Coming soon">+ Add Instrument <span class="coming-soon">Coming soon</span></button>
  </div>

  <!-- Floating editor overlay -->
  <div id="editor-overlay" class="hidden">
    <div id="editor">
      <div class="editor-header">
        <span id="editor-instrument-name">Violin I</span>
        <button id="editor-prev-measure" class="transport-btn-sm" title="Previous measure (&larr;)">&larr;</button>
        <span id="editor-measure-label">Measure 1</span>
        <button id="editor-next-measure" class="transport-btn-sm" title="Next measure (&rarr;)">&rarr;</button>
        <button id="editor-close" title="Close (Esc)">&times;</button>
      </div>
      <div class="editor-toolbar">
        <div class="toolbar-group">
          <span class="toolbar-label">Duration</span>
          <button class="dur-btn" data-duration="whole" title="Whole note (1)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <ellipse cx="10" cy="10" rx="7" ry="4.5" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button class="dur-btn" data-duration="half" title="Half note (2)">
            <svg width="20" height="24" viewBox="0 0 20 24">
              <ellipse cx="8" cy="16" rx="6" ry="4" fill="none" stroke="currentColor" stroke-width="2" transform="rotate(-20 8 16)"/>
              <line x1="13.5" y1="14" x2="13.5" y2="2" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button class="dur-btn active" data-duration="quarter" title="Quarter note (3)">
            <svg width="20" height="24" viewBox="0 0 20 24">
              <ellipse cx="8" cy="16" rx="6" ry="4" fill="currentColor" transform="rotate(-20 8 16)"/>
              <line x1="13.5" y1="14" x2="13.5" y2="2" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button class="dur-btn" data-duration="eighth" title="Eighth note (4)">
            <svg width="20" height="24" viewBox="0 0 20 24">
              <ellipse cx="8" cy="16" rx="6" ry="4" fill="currentColor" transform="rotate(-20 8 16)"/>
              <line x1="13.5" y1="14" x2="13.5" y2="2" stroke="currentColor" stroke-width="2"/>
              <path d="M13.5 2 C16 3.5 18 6 16 9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button class="dur-btn" data-duration="sixteenth" title="Sixteenth note (5)">
            <svg width="20" height="24" viewBox="0 0 20 24">
              <ellipse cx="8" cy="16" rx="6" ry="4" fill="currentColor" transform="rotate(-20 8 16)"/>
              <line x1="13.5" y1="14" x2="13.5" y2="2" stroke="currentColor" stroke-width="2"/>
              <path d="M13.5 2 C16 3.5 18 6 16 9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M13.5 6 C16 7.5 18 10 16 13" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Mode</span>
          <button id="rest-toggle" class="tool-btn" title="Rest mode (R)">Rest</button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Expr.</span>
          <button id="vibrato-toggle" class="tool-btn" title="Vibrato (V)">Vibrato</button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Accidental</span>
          <button class="acc-btn" data-accidental="sharp" title="Sharp">&#9839;</button>
          <button class="acc-btn" data-accidental="flat" title="Flat">&#9837;</button>
          <button class="acc-btn" data-accidental="natural" title="Natural">&#9838;</button>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Dynamic</span>
          <select id="dynamic-select">
            <option value="pp">pp</option>
            <option value="p">p</option>
            <option value="mp">mp</option>
            <option value="mf" selected>mf</option>
            <option value="f">f</option>
            <option value="ff">ff</option>
          </select>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Key</span>
          <select id="key-sig-select">
            <option value="C">C</option>
            <option value="G">G</option>
            <option value="D">D</option>
            <option value="A">A</option>
            <option value="E">E</option>
            <option value="B">B</option>
            <option value="F#">F♯</option>
            <option value="F">F</option>
            <option value="Bb">B♭</option>
            <option value="Eb">E♭</option>
            <option value="Ab">A♭</option>
            <option value="Db">D♭</option>
            <option value="Gb">G♭</option>
          </select>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Time</span>
          <select id="time-sig-select">
            <option value="2/4">2/4</option>
            <option value="3/4">3/4</option>
            <option value="4/4">4/4</option>
            <option value="5/4">5/4</option>
            <option value="6/4">6/4</option>
            <option value="6/8">6/8</option>
            <option value="3/8">3/8</option>
          </select>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">BPM</span>
          <input id="tempo-input" type="number" min="20" max="300" value="100" title="Tempo (BPM) for this measure">
        </div>
        <div class="toolbar-group">
          <button id="undo-btn" class="tool-btn" title="Undo (Ctrl+Z)">Undo</button>
        </div>
      </div>
      <div id="editor-score-wrapper">
        <div id="editor-score"></div>
        <canvas id="ghost-canvas"></canvas>
      </div>
      <div class="editor-hint">Hover to preview note position. Click to place. Keys: 1-5 duration, R rest, V vibrato, Ctrl+Z undo.</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.3/build/cjs/vexflow.js"></script>
  <script type="module" src="/js/api.js"></script>
  <script type="module" src="/js/renderer.js"></script>
  <script type="module" src="/js/editor.js"></script>
  <script type="module" src="/js/playback.js"></script>
  <script type="module" src="/js/app.js"></script>
</body>
</html>
